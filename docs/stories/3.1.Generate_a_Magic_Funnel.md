# Story 3.1: Generate a "Magic Funnel"

## Status: Approved

## Story
**As a Conscious Creator,** I want to select an "Offering" and generate a complete marketing funnel for it with one click, **so that** I can create a coherent customer journey without manual setup.

## Acceptance Criteria
1.  On the detail page for an "Offering", there is a "Generate Funnel" button.
2.  Clicking the button triggers the AI to generate a landing page and a simple 3-step follow-up sequence (for email or WhatsApp).
3.  The generated assets are based on the Brand Heart, the Offering details, and its contextual notes.
4.  If bilingual, all assets (landing page copy, follow-up messages) are generated in both languages.
5.  The user is presented with a view showing the generated landing page and the follow-up sequence.

## Tasks / Subtasks
- [ ] **Task 1: Add "Generate Funnel" UI (AC: 1)**
    - [ ] On the "Offering Detail" page (`apps/web/src/pages/offerings/[id].tsx`), add a "Generate Funnel" button.
- [ ] **Task 2: Develop Backend AI Service for Funnels (AC: 2, 3, 4)**
    - [ ] In the Nest.js app, create a new GraphQL mutation (e.g., `generateFunnelForOffering`).
    - [ ] The resolver for this mutation will construct a detailed prompt for the AI, combining the Brand Heart and Offering data.
    - [ ] The prompt should request a JSON object containing `landingPageContent` and a `followUpSequence` array.
    - [ ] The service will call the external AI API and parse the response.
- [ ] **Task 3: Store Generated Funnel Assets (AC: 2)**
    - [ ] Define a new data model for `Funnel` and `FunnelStep`.
    - [ ] Save the generated landing page content and follow-up steps to the database, associated with the Offering.
- [ ] **Task 4: Display the Generated Funnel (AC: 5)**
    - [ ] On the frontend, after the mutation is successful, redirect the user to a new "Funnel Builder" page.
    - [ ] This page will display the generated landing page content and the list of follow-up steps.

## Dev Notes
### Data Models
*   **Funnel:** Will need a new table to store funnel data, linked to an `Offering`. Should include landing page content.
*   **FunnelStep:** Will need a table for the steps in a follow-up sequence, linked to a `Funnel`.
### AI Integration
*   The prompt engineering for this task is critical. The prompt must clearly ask for a structured JSON response to be easily parsable.
    *Source: `docs/architecture/high-level-architecture.md`*
