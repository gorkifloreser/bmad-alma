# Story 4.2: Automate Testimonial Requests

## Status: Approved

## Story
**As a Conscious Creator,** I want the platform to automatically ask for a testimonial after an "Offering" is completed, **so that** I can consistently gather social proof without manual effort.

## Acceptance Criteria
1.  When an "Offering" is marked as "Completed" on the Harvest Circle dashboard, an automated workflow is triggered.
2.  The system sends a pre-defined, personalized message via Email or WhatsApp asking for feedback/testimonial.
3.  The message is based on templates that can be customized by the user in the settings.
4.  The system waits for a configurable amount of time (e.g., 3 days) after completion before sending the request.

## Tasks / Subtasks
- [ ] **Task 1: Create Testimonial Request Templates (AC: 3)**
    - [ ] Create a new section in the "Settings" page for "Message Templates".
    - [ ] Allow the user to create and edit templates for testimonial requests for both Email and WhatsApp.
    - [ ] Templates should support simple variables (e.g., `{{customer_name}}`, `{{offering_title}}`).
- [ ] **Task 2: Develop Backend Workflow (AC: 1, 2, 4)**
    - [ ] In the `Engagement` mutation where the status is updated, add a trigger for when the status changes to "Completed".
    - [ ] This trigger should schedule a job (e.g., using a queue like BullMQ or a simple cron job) to run after a configurable delay.
    - [ ] The job will fetch the appropriate template, personalize it, and send it via the configured service (Email/WhatsApp).
- [ ] **Task 3: Integrate Email and WhatsApp Services (AC: 2)**
    - [ ] In the backend, add services to integrate with an email provider (e.g., Resend) and a WhatsApp provider (e.g., Twilio).
    - [ ] Securely manage API keys for these services.

## Dev Notes
### Third-Party Integrations
*   This story requires integrating with external APIs for Email and WhatsApp. This will involve setting up SDKs and managing API keys.
    *Source: `docs/architecture/high-level-architecture.md`*
### Asynchronous Tasks
*   A job queue or scheduler is necessary to handle the delayed sending of messages. This is a key piece of new infrastructure for the backend.
